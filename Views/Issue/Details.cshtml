@model AdvisementSys.Models.Request.DetailsIssueRequestModel
@{
    ViewBag.Title = "Details";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
<script src="@Url.Content("~/Scripts/jquery-1.7.2.min.js")" type="text/javascript"></script>
<link href="@Url.Content("~/Content/kendo/2012.2.710/kendo.common.min.css")" rel="stylesheet"
    type="text/css" />
<link href="@Url.Content("~/Content/kendo/2012.2.710/kendo.metro.min.css")" rel="stylesheet"
        type="text/css" />
<script src="@Url.Content("~/Scripts/kendo/2012.2.710/kendo.web.min.js")" type="text/javascript"></script>
<link href="@Url.Content("~/Content/css/web.form.css")" rel="stylesheet" type="text/css" />
<link href="@Url.Content("~/Content/css/grid.form.css")" rel="stylesheet" type="text/css" />
<script src="@Url.Content("~/Scripts/jquery-ui-1.8.11.min.js")" type="text/javascript"></script>
<link href="@Url.Content("~/Content/themes/base/jquery.ui.all.css")" rel="stylesheet" type="text/css" />

<div class="contentDiv">
    <h2 style="padding-left: 13px;">
        Issue Details for: @Html.DisplayFor(model => model._student.fname) @Html.DisplayFor(model => model._student.lname)</h2>
    <table class="tableDetail">
        <tr>
            <td>
                <h3>
                    Student Information</h3>
            </td>
        </tr>
        <tr>
            <td>
                <div class="display-label">
                    Student ID:</div>
            </td>
            <td>
                <div class="display-field">
                    @Html.DisplayFor(model => model._student.studentid)
                </div>
            </td>
            <td>
                <div class="display-label">
                    Email:</div>
            </td>
            <td>
                <div class="display-field">
                    @Html.DisplayFor(model => model._student.email)
                </div>
            </td>
        </tr>
        <tr>
            <td>
                <div class="display-label">
                    First Name:</div>
            </td>
            <td>
                <div class="display-field">
                    @Html.DisplayFor(model => model._student.fname)
                </div>
            </td>
            <td>
                <div class="display-label">
                    Phone Number:</div>
            </td>
            <td>
                <div class="display-field">
                    @Html.DisplayFor(model => model._student.phonenum)
                </div>
            </td>
        </tr>
        <tr>
            <td>
                <div class="display-label">
                    Last Name:</div>
            </td>
            <td>
                <div class="display-field">
                    @Html.DisplayFor(model => model._student.lname)
                </div>
            </td>
            <td>
                <div class="display-label">
                    Cell Number:</div>
            </td>
            <td>
                <div class="display-field">
                    @Html.DisplayFor(model => model._student.cellnum)
                </div>
            </td>
        </tr>
        <tr>
            <td>
                <div class="display-label">
                    Program:</div>
            </td>
            <td>
                <div class="display-field">
                    @Html.DisplayFor(model => model._student.programcode) - @Html.DisplayFor(model => model._program.programname)
                </div>
            </td>
            <td>
                <div class="display-label">
                    Campus:</div>
            </td>
            <td>
                <div class="display-field">
                    @Html.DisplayFor(model => model._student.campus)
                </div>
            </td>
        </tr>
        <tr>
            <td>
                <h3>
                    Issue Information</h3>
            </td>
        </tr>
        <tr>
            <td>
                <div class="display-label">
                    Issue Name:</div>
            </td>
            <td>
                <div class="display-field">
                    @Html.DisplayFor(model => model._issue.issuename)
                </div>
            </td>
            <td>
                <div class="display-label">
                    Date:</div>
            </td>
            <td>
                <div class="display-field">
                    @Html.DisplayFor(model => model._issue.date, new { @Value = Model._issue.date.ToShortDateString() })
                </div>
            </td>
        </tr>
        <tr>
            <td>
                <div class="display-label">
                    Status:</div>
            </td>
            <td>
                <div class="display-field">
                    @Html.DisplayFor(model => model._issue.status)
                </div>
            </td>
            <td>
                <div class="display-label">
                    Urgency:</div>
            </td>
            <td>
                <div class="display-field">
                    @Html.DisplayFor(model => model._issue.urgency)
                </div>
            </td>
        </tr>
        <tr>
            <td>
                <div class="display-label">
                    Owner:</div>
            </td>
            <td>
                <div class="display-field">
                    @Html.DisplayFor(model => model._EmployeeID)
                </div>
            </td>
            <td>
                <div class="display-label">
                    Category:</div>
            </td>
            <td>
                <div class="display-field">
                    @Html.DisplayFor(model => model._issue.catagory)
                </div>
            </td>
        </tr>
        <tr>
            <td>
                Description:
            </td>
            <td>
                <div class="display-field">
                    @Html.DisplayFor(model => model._issue.description)
                </div>
            </td>   
        </tr>
    </table>
    <p>
        @Html.ActionLink("Edit", "Edit", new { id = Model._issue.issueid }) |
        @Html.ActionLink("Back to Student Details", "Details/" + Model._issue.studentid, "Student")
    </p>

    <div id="accordion" style="width:740px;">
	    <h3><a href="#">Create New Form</a></h3>
	    <div>
            @Html.ActionLink("Create New Probationary Contract Form", "create/" + Model._issue.issueid, "ProbationaryContract")
            <br />
            @Html.ActionLink("Create New Part-Time and/or Additional Course Registration Form", "create/" + Model._issue.issueid, "CourseRegistration")
            <br />
            @Html.ActionLink("Create New Request for Late Enrolment Form", "create/" + Model._issue.issueid, "LateEnrollment")
            <br />
            @Html.ActionLink("Create New Application for Term or Complete Program Withdrawal Form", "create/" + Model._issue.issueid, "ProgramWithdrawal")
            <br />
            @Html.ActionLink("Create New Application for Readmission Form", "create/" + Model._issue.issueid, "Readmission")
        </div>
    </div>
    <br />

    <div id="grid" style="height: 380px; width:80%;"></div>

    <br />
    <a href="#noteCreate">Click here to go to the bottom of the page.</a>
    <br />
@foreach (var item in Model._note)
{
    <table class="resultstd">
        <tr>
            <td>
                @Html.DisplayFor(modelItem => item.employee.fname) &nbsp; @Html.DisplayFor(modelItem => item.employee.lname) <br /> @Html.DisplayFor(modelItem => item.dates)
            </td>
            <td>
                @Html.DisplayFor(modelItem => item.employee.faculty) <br /> <a href="mailto:@item.employee.email?subject=@Model._issue.issuename, Catagory: @Model._issue.catagory, Urgency: @Model._issue.urgency &body=@Request.Url.ToString()"> @Html.DisplayFor(modelItem => item.employee.email) </a> <br /> @Html.DisplayFor(modelItem => item.employee.phonenum)
            </td>
            <td>
                @if (User.Identity.Name == item.employeeid)
                {
                    @Html.ActionLink("Edit Issue Note", "EditNote", new { id = item.noteid })
                }
            </td>
        </tr>
        @if (item.formid != null)
                {
            <tr>
                <td colspan="3">
                    @Html.ActionLink("View related Form", "Details/" + item.formid, item.controller)
                </td>
            </tr>
           }
        <tr>
            <td colspan="3">
                @Html.DisplayFor(modelItem => item.notes)
            </td>
        </tr>
    </table>
    <br />
}

@using (Html.BeginForm())
{
    @Html.ValidationSummary(true)
    <fieldset id="noteCreate">
    @Html.HiddenFor(model => model._newNote.issueid, new { @Value = Model._issue.issueid })
        <table>
            <tr>
            <td>
                @Html.DisplayFor(model => model._employee.fname) &nbsp; @Html.DisplayFor(model => model._employee.lname) <br /> @Html.DisplayFor(model => model._date, new { @Value = Model._date.ToString("dd/MM/yyyy") })
            </td>
            <td>
                @Html.DisplayFor(model => model._employee.faculty) <br /> @Html.DisplayFor(model => model._employee.email) <br /> @Html.DisplayFor(model => model._employee.phonenum)
            </td>
            </tr>
            <tr>
                <td colspan="2">
                    @Html.TextAreaFor(model => model._newNote.notes, new { @style = "width:775px; height:200px; resize:none;" })
                </td>
            </tr>
            <tr>
                <td>
                    <p>
                        <input type="submit" value="Create" />
                    </p>
                </td>
            </tr>
        </table>
    </fieldset>
}
</div>

<script type="text/javascript">
    $(document).ready(function () {
        $("#accordion").accordion({ collapsible: true, active: 2 });

        function customParser(data) {
            return new Date(data);
        }

        var model = @Html.Raw(Json.Encode(Model._Forms));
        
       $("#grid").kendoGrid({
                        dataSource: {
                            data: model,
                            pageSize: 15,
                            schema: {
                                model: {
                                    fields: {
                                        Date: { type: "date", parse: customParser }
                                    }
                                }           
                            }
                        },
                        groupable: true,
                        sortable: true,
                        selectable: true,
                        pageable: {
                            refresh: true,
                            pageSizes: true
                        },
                        columns: [ {
                                field: "Date",
                                title: "Form Date",
                                template: '#= kendo.toString(Date,"dd MMMM yyyy") #'
                            } , {
                                field: "FormType",
                                title: "Form Name",
                                template: '<a href="/#=Controller#/Details/#=FormID#">#=FormType#</a>'
                            } , {
                                field: "Status",
                                title: "Form Status"
                            }
                        ]
        });
    });
</script>