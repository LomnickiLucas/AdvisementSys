@model AdvisementSys.Models.Request.DetailsIssueRequestModel
@{
    ViewBag.Title = "Issue Details";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
<script src="@Url.Content("~/Scripts/jquery-1.7.2.min.js")" type="text/javascript"></script>
<link href="@Url.Content("~/Content/kendo/2012.2.710/kendo.common.min.css")" rel="stylesheet"
    type="text/css" />
<link href="@Url.Content("~/Content/kendo/2012.2.710/kendo.metro.min.css")" rel="stylesheet"
        type="text/css" />
<script src="@Url.Content("~/Scripts/kendo/2012.2.710/kendo.web.min.js")" type="text/javascript"></script>
<link href="@Url.Content("~/Content/css/web.form.css")" rel="stylesheet" type="text/css" />
<link href="@Url.Content("~/Content/css/grid.form.css")" rel="stylesheet" type="text/css" />
<link href="@Url.Content("~/Content/css/note.form.css")" rel="stylesheet" type="text/css" />
<script src="@Url.Content("~/Scripts/jquery-ui-1.8.11.min.js")" type="text/javascript"></script>
<link href="@Url.Content("~/Content/themes/base/jquery.ui.all.css")" rel="stylesheet" type="text/css" />
<div class="contentDiv" id="topAnchor">
    <h2 style="padding-left: 13px;">
        Issue Details for: @Html.DisplayFor(model => model._student.fname) @Html.DisplayFor(model => model._student.lname)</h2>
    <table class="tableDetail">
        <tr>
            <td>
                <h3>
                    Student Information</h3>
            </td>
        </tr>
        <tr>
            <td>
                <div class="display-label">
                    Student ID:</div>
            </td>
            <td>
                <div class="display-field">
                    @Html.DisplayFor(model => model._student.studentid)
                </div>
            </td>
            <td>
                <div class="display-label">
                    Email:</div>
            </td>
            <td>
                <div class="display-field">
                <a href="mailto:@Model._student.email?subject=@Model._issue.issuename">
                    @Html.DisplayFor(model => model._student.email)
                    </a>
                </div>
            </td>
        </tr>
        <tr>
            <td>
                <div class="display-label">
                    First Name:</div>
            </td>
            <td>
                <div class="display-field">
                    @Html.DisplayFor(model => model._student.fname)
                </div>
            </td>
            <td>
                <div class="display-label">
                    Phone Number:</div>
            </td>
            <td>
                <div class="display-field">
                    @Html.DisplayFor(model => model._student.phonenum)
                </div>
            </td>
        </tr>
        <tr>
            <td>
                <div class="display-label">
                    Last Name:</div>
            </td>
            <td>
                <div class="display-field">
                    @Html.DisplayFor(model => model._student.lname)
                </div>
            </td>
            <td>
                <div class="display-label">
                    Cell Number:</div>
            </td>
            <td>
                <div class="display-field">
                    @Html.DisplayFor(model => model._student.cellnum)
                </div>
            </td>
        </tr>
        <tr>
            <td>
                <div class="display-label">
                    Program:</div>
            </td>
            <td>
                <div class="display-field">
                    @Html.DisplayFor(model => model._student.programcode) - @Html.DisplayFor(model => model._program.programname)
                </div>
            </td>
            <td>
                <div class="display-label">
                    Campus:</div>
            </td>
            <td>
                <div class="display-field">
                    @Html.DisplayFor(model => model._student.campus)
                </div>
            </td>
        </tr>
        <tr>
            <td>
                <h3>
                    Issue Information</h3>
            </td>
        </tr>
        <tr>
            <td>
                <div class="display-label">
                    Issue Name:</div>
            </td>
            <td>
                <div class="display-field">
                    @Html.DisplayFor(model => model._issue.issuename)
                </div>
            </td>
            <td>
                <div class="display-label">
                    Date:</div>
            </td>
            <td>
                <div class="display-field">
                    @Html.DisplayFor(model => model._issue.date, new { @Value = Model._issue.date.ToShortDateString() })
                </div>
            </td>
        </tr>
        <tr>
            <td>
                <div class="display-label">
                    Status:</div>
            </td>
            <td>
                <div class="display-field">
                    @Html.DisplayFor(model => model._issue.status)
                </div>
            </td>
            <td>
                <div class="display-label">
                    Urgency:</div>
            </td>
            <td>
                <div class="display-field">
                    @Html.DisplayFor(model => model._issue.urgency)
                </div>
            </td>
        </tr>
        <tr>
            <td>
                <div class="display-label">
                    Owner:</div>
            </td>
            <td>
                <div class="display-field">
                    @Html.DisplayFor(model => model._EmployeeID)
                </div>
            </td>
            <td>
                <div class="display-label">
                    Category:</div>
            </td>
            <td>
                <div class="display-field">
                    @Html.DisplayFor(model => model._issue.catagory)
                </div>
            </td>
        </tr>
        <tr>
            <td>
                Description:
            </td>
            <td>
                <div class="display-field">
                    @Html.DisplayFor(model => model._issue.description)
                </div>
            </td>
        </tr>
    </table>
    <p>
        @Html.ActionLink("Edit", "Edit", new { id = Model._issue.issueid }) |
        @Html.ActionLink("Back to Student Details", "Details/" + Model._issue.studentid, "Student") | 
        @Html.ActionLink("Create an appointment", "Create", "Calendar" , new { id = Model._student.studentid, subject = Model._issue.issuename }, null)
    </p>
    <div id="accordion" style="width: 65.5%;">
        <h3 style="color: #C7FFFF;">
            <a href="#">Create New Form</a></h3>
        <div>
            @Html.ActionLink("Create New Probationary Contract Form", "create/" + Model._issue.issueid, "ProbationaryContract")
            <br />
            @Html.ActionLink("Create New Part-Time and/or Additional Course Registration Form", "create/" + Model._issue.issueid, "CourseRegistration")
            <br />
            @Html.ActionLink("Create New Request for Late Enrolment Form", "create/" + Model._issue.issueid, "LateEnrollment")
            <br />
            @Html.ActionLink("Create New Application for Term or Complete Program Withdrawal Form", "create/" + Model._issue.issueid, "ProgramWithdrawal")
            <br />
            @Html.ActionLink("Create New Application for Readmission Form", "create/" + Model._issue.issueid, "Readmission")
        </div>
    </div>
    <br />
    <div id="grid" style="height: 380px; width: 65.5%;">
    </div>
    <br />
    <a href="#noteCreate">Create New Note</a>
    <br />
    @foreach (var item in Model._note)
    {
        <table class="noteThread">
            <thead>
                <tr>
                    <td>
                        <strong>@Html.DisplayFor(modelItem => item.employee.fname) @Html.DisplayFor(modelItem => item.employee.lname)</strong>
                    </td>
                    <td style="text-align: right;">
                        <strong>@Html.DisplayFor(modelItem => item.dates)</strong>
                    </td>
                </tr>
                <tr>
                    <td>
                        @Html.DisplayFor(modelItem => item.employee.faculty)
                    </td>
                    <td style="text-align: right;">
                        <a href="mailto:@item.employee.email?subject=@Model._issue.issuename, Category: @Model._issue.catagory, Urgency: @Model._issue.urgency.Trim(), Student: @Model._student.fname @Model._student.lname, In regards to the Student Acvisement System. &body=@Request.Url.ToString()">
                            @Html.DisplayFor(modelItem => item.employee.email) </a>
                    </td>
                </tr>
                <tr>
                    <td>
                        @if (User.Identity.Name == item.employeeid)
                        {
                            @Html.ActionLink("Edit Issue Note", "EditNote", new { id = item.noteid })
                        }
                        &nbsp;
                        @if (item.formid != null)
                        {
                            if ((item.formid != null) && (User.Identity.Name == item.employeeid))
                            {
                            <span>| &nbsp;</span>
                            }
                            @Html.ActionLink("View related Form", "Details/" + item.formid, item.controller)             
                        }
                    </td>
                    <td style="text-align: right;">
                        @Html.DisplayFor(modelItem => item.employee.phonenum)
                    </td>
                </tr>
            </thead>
            <tbody style="background-color: #F5F5F5;">
                <tr>
                    <td colspan="2">
                        @Html.TextAreaFor(modelItem => item.notes, new { @style = "width:800px; height:100px;overflow: hidden; border: none;background:none", @readonly = "readonly" })
                    </td>
                </tr>
            </tbody>
        </table>
        <br />
    }
    @using (Html.BeginForm())
    {
        @Html.ValidationSummary(true)
       
            
        <table class="addNoteBox" id="noteCreate">
            <tr>
                <td colspan="2" style="text-align:center;">
                    <h3>
                        New Note</h3>
                    @Html.HiddenFor(model => model._newNote.issueid, new { @Value = Model._issue.issueid })
                </td>
            </tr>
            <tr>
                <td>
                    @Html.DisplayFor(model => model._employee.fname)&nbsp;@Html.DisplayFor(model => model._employee.lname)
                </td>
                <td style="text-align: right;">
                    @Html.DisplayFor(model => model._date, new { @Value = Model._date.ToString("dd/MM/yyyy") })
                </td>
            </tr>
            <tr>
                <td>
                    @Html.DisplayFor(model => model._employee.faculty)
                </td>
                <td style="text-align: right;">
                    @Html.DisplayFor(model => model._employee.email)
                </td>
            </tr>
            <tr>
                <td colspan="2" style="text-align:right;">
                    @Html.DisplayFor(model => model._employee.phonenum)
                </td>
            </tr>
            <tr>
                <td colspan="2">
                    @Html.TextAreaFor(model => model._newNote.notes, new { @style = "width:770px; height:200px; resize:none;" })
                </td>
            </tr>
            <tr>
                <td>
                    <input type="submit" value="Create Note" class="Button" style="position: relative;
                        left: 10px;" />
                </td>
            </tr>
        </table>
      
        <br />
        @Html.ActionLink("Back to Student Details", "Details/" + Model._issue.studentid, "Student") <span>
            | </span> <a href="#topAnchor">Go to Top</a>  
        <br />
    }
</div>
<script type="text/javascript">
    $(document).ready(function () {

        $("#accordion").accordion({ collapsible: true, active: 2 });

        function customParser(data) {
            return new Date(data * 1000);
        }

        var model = @Html.Raw(Json.Encode(Model._Forms));
        
       $("#grid").kendoGrid({
                        dataSource: {
                            data: model,
                            pageSize: 15,
                            schema: {
                                model: {
                                    fields: {
                                        Date: { type: "date", parse: customParser }
                                    }
                                }           
                            }
                        },
                        groupable: true,
                        sortable: true,
                        selectable: true,
                        pageable: {
                            refresh: true,
                            pageSizes: true
                        },
                        columns: [ {
                                field: "Date",
                                title: "Form Date",
                                width: "130px",
                                template: '#= kendo.toString(Date,"dd MMMM yyyy") #'
                            } , {
                                field: "FormType",
                                title: "Form Name",
                                template: '<a href="/#=Controller#/Details/#=FormID#">#=FormType#</a>'
                            } , {
                                field: "Status",
                                title: "Form Status",
                                width: "130px",
                            }
                        ]
        });
    });
</script>
